First reaction, it's a dp question.

But I failed to find the dp relation at first, so went to the normal loop and recursion path, which is correct but times out quickly when strings grow longer.

The dp one is actually a normal 3d dp which isn't too difficult and not too tricky in the details.
