I spent 3 days trying to find a solution.\
It turns out to be a slight improvement over the dummy N^3 solution.\
What the fuck, waste of time.